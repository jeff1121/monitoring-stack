# Alertmanager é…ç½®æª”
global:
  # è§£æ±ºè¶…æ™‚æ™‚é–“ï¼ˆå‘Šè­¦å¤šä¹…æ²’æœ‰æ›´æ–°å°±è¦–ç‚ºå·²è§£æ±ºï¼‰
  resolve_timeout: 5m

  # SMTP éƒµä»¶é…ç½®ï¼ˆä¾éœ€æ±‚ä¿®æ”¹ï¼‰
  # smtp_smarthost: 'smtp.example.com:587'
  # smtp_from: 'alertmanager@example.com'
  # smtp_auth_username: 'alertmanager@example.com'
  # smtp_auth_password: 'your-password'
  # smtp_require_tls: true

  # Slack é…ç½®ï¼ˆä¾éœ€æ±‚ä¿®æ”¹ï¼‰
  # slack_api_url: 'https://hooks.slack.com/services/YOUR/SLACK/WEBHOOK'

# å‘Šè­¦è·¯ç”±é…ç½®
route:
  # é è¨­åˆ†çµ„æ¨™ç±¤
  group_by: ['alertname', 'cluster', 'service']
  
  # åˆ†çµ„ç­‰å¾…æ™‚é–“ï¼ˆæ”¶åˆ°ç¬¬ä¸€å€‹å‘Šè­¦å¾Œç­‰å¾…å¤šä¹…å†ç™¼é€ï¼‰
  group_wait: 30s
  
  # åŒä¸€åˆ†çµ„å‘Šè­¦çš„ç™¼é€é–“éš”
  group_interval: 5m
  
  # é‡è¤‡å‘Šè­¦çš„ç™¼é€é–“éš”
  repeat_interval: 4h
  
  # é è¨­æ¥æ”¶è€…
  receiver: 'default-receiver'
  
  # å­è·¯ç”±ï¼ˆä¾åš´é‡ç¨‹åº¦åˆ†æµï¼‰
  routes:
    # Critical å‘Šè­¦ - ç«‹å³é€šçŸ¥
    - match:
        severity: critical
      receiver: 'critical-receiver'
      group_wait: 10s
      repeat_interval: 1h
      continue: true

    # Warning å‘Šè­¦
    - match:
        severity: warning
      receiver: 'warning-receiver'
      repeat_interval: 4h

    # Thanos ç›¸é—œå‘Šè­¦
    - match_re:
        alertname: ^Thanos.*
      receiver: 'thanos-receiver'

    # MinIO ç›¸é—œå‘Šè­¦
    - match_re:
        alertname: ^Minio.*
      receiver: 'minio-receiver'

# æŠ‘åˆ¶è¦å‰‡ï¼ˆé¿å…å‘Šè­¦é¢¨æš´ï¼‰
inhibit_rules:
  # ç•¶æœ‰ critical å‘Šè­¦æ™‚ï¼ŒæŠ‘åˆ¶åŒä¸€æœå‹™çš„ warning å‘Šè­¦
  - source_match:
      severity: 'critical'
    target_match:
      severity: 'warning'
    equal: ['alertname', 'cluster', 'service']

  # ç•¶æœå‹™ä¸‹ç·šæ™‚ï¼ŒæŠ‘åˆ¶è©²æœå‹™çš„å…¶ä»–å‘Šè­¦
  - source_match:
      alertname: 'ServiceDown'
    target_match_re:
      alertname: '.+'
    equal: ['job', 'instance']

# æ¥æ”¶è€…é…ç½®
receivers:
  # é è¨­æ¥æ”¶è€…ï¼ˆWebhook ç¯„ä¾‹ï¼‰
  - name: 'default-receiver'
    webhook_configs:
      - url: 'http://localhost:5001/webhook'
        send_resolved: true
    # å¯ä»¥åŒæ™‚é…ç½®å¤šå€‹é€šçŸ¥æ–¹å¼
    # email_configs:
    #   - to: 'team@example.com'

  # Critical å‘Šè­¦æ¥æ”¶è€…
  - name: 'critical-receiver'
    webhook_configs:
      - url: 'http://localhost:5001/webhook/critical'
        send_resolved: true
    # slack_configs:
    #   - channel: '#alerts-critical'
    #     send_resolved: true
    #     title: 'ğŸš¨ Critical Alert'
    #     text: '{{ range .Alerts }}{{ .Annotations.summary }}\n{{ .Annotations.description }}\n{{ end }}'
    # pagerduty_configs:
    #   - service_key: 'your-pagerduty-service-key'

  # Warning å‘Šè­¦æ¥æ”¶è€…
  - name: 'warning-receiver'
    webhook_configs:
      - url: 'http://localhost:5001/webhook/warning'
        send_resolved: true
    # slack_configs:
    #   - channel: '#alerts-warning'
    #     send_resolved: true

  # Thanos å°ˆç”¨æ¥æ”¶è€…
  - name: 'thanos-receiver'
    webhook_configs:
      - url: 'http://localhost:5001/webhook/thanos'
        send_resolved: true

  # MinIO å°ˆç”¨æ¥æ”¶è€…
  - name: 'minio-receiver'
    webhook_configs:
      - url: 'http://localhost:5001/webhook/minio'
        send_resolved: true

# å‘Šè­¦æ¨¡æ¿ï¼ˆå¯é¸ï¼‰
# templates:
#   - '/etc/alertmanager/templates/*.tmpl'
